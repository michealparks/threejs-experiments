<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="favicon.ico" />
  <title>ThreeJS Experiments | Micheal Parks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='index.css' />

  <link rel="modulepreload" href="core/gl.js">
  <link rel="modulepreload" href="core/assets.js">
  <link rel="modulepreload" href="core/constants.js">
  <link rel="modulepreload" href="core/orbitControls.js">
</head>

<body>
  <nav>
    <ul>
      <li><a data-href='textures'>Textures</a></li>
      <li><a data-href='solar-system'>Solar System</a></li>
      <li><a data-href='baked-texture'>Baked Textures</a></li>
      <li><a data-href='matrix'>Matrix</a></li>
      <li><a data-href='donut'>Donut</a></li>
      <li><a data-href='alley'>Alley</a></li>
      <li><a data-href='instanced-gltf'>Instanced Mesh</a></li>
      <li><a data-href='campfire'>Campfire</a></li>
      <li><a data-href='room'>Room</a></li>
      <li><a data-href='pixel_room'>Pixel Room</a></li>
      <li><a data-href='spooky'>Spooky House</a></li>
      <li><a data-href='hello-shader'>Hello Shader!</a></li>
    </ul>
  </nav>
  
  <script type="module">
    import { gl } from './core/gl.js'

    let unmountCallback

    const handleClick = (e) => {
      e.preventDefault()

      const path = e.target.dataset.href

      import(`./experiments/${path}.js`).then(loadModule)

      location.hash = path
    }

    const loadModule = (module) => {
      if (unmountCallback) {
        unmountCallback()
      }

      module.init().then(fn => (unmountCallback = fn))
    }

    const init = () => {
      for (const link of document.querySelectorAll('a')) {
        link.addEventListener('click', handleClick)
      }

      Promise.all([
        location.hash === ''
          ? import(`./experiments/baked-texture.js`)
          : import(`./experiments/${location.hash.substring(1)}.js`),
        gl.init(),
      ]).then(([module]) => loadModule(module))
    }

    init()
  </script>
</body>

</html>