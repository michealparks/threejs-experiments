<title>ThreeJS Experiments: Donut | Micheal Parks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel='stylesheet' href='css/index.css' />

<a id='back' class='button' href='/threejs-experiments'>Back</a>

<script type='module'>
  if (window !== window.top) window.back.style.display = 'none'
</script>

<canvas></canvas>

<script type='module'>
import {
  THREE,
  renderer,
  camera,
  scene,
  ambientLight,
  setAnimationLoop,
  initXR,
  postprocessing,
  orbitControls
} from './js/core.js'

import { loadModels } from './js/loaders.js'
import { COLORS, SHADOW_MAP } from './js/constants.js'

ambientLight.intensity = 0.8

postprocessing.setBloomPass({
  threshold: 0,
  strength: 0.3,
  radius: 0.5
})
postprocessing.setFxaaPass()

camera.position.set(1.0, 0.9, 1.0)

const controls = orbitControls()
controls.autoRotate = false

const main = async () => {
  const [donutScene] = await loadModels([
    { src: 'assets/gltf/donut_animated.glb', shadows: true }
  ], () => {

  })

  console.log(donutScene.clips)

  donutScene.setAnimation('PlateAction')

  console.log(donutScene.clip)

  {
    const floor = donutScene.getObjectByName('Floor')
    floor.castShadow = false
  }
  scene.add(donutScene)

  {
    const intensity = 5.0
    const light = new THREE.SpotLight(COLORS.warmLight, intensity)
    light.castShadow = true
    light.angle = 50
    light.penumbra = 1

    light.shadow.radius = 8
    light.shadow.bias = -0.0001

    light.position.set(1.2, 1, 1.2)
    scene.add(light)
  }

  const frame = (time) => {
    donutScene.mixer.update( time )
    controls.update()
  }

  initXR()
  setAnimationLoop({ frame, postprocessing: true })
}

main()
</script>
