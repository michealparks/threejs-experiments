<title>ThreeJS Experiments: Donut | Micheal Parks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel='stylesheet' href='css/index.css' />

<a id='back' class='button' href='/threejs-experiments'>Back</a>

<script type='module'>
  if (window !== window.top) window.back.style.display = 'none'
</script>

<canvas></canvas>

<script type='module'>
import {
  THREE,
  renderer,
  camera,
  scene,
  ambientLight,
  postprocessing,
  setAnimationLoop,
  initXR,
  orbitControls
} from './js/core.js'

import { loadModels } from './js/loaders.js'
import { randNumInRange, randomPointInCircle } from './js/util.js'
import { createSkySphere } from './js/objects.js'
import { COLORS, SHADOW_MAP } from './js/constants.js'
import { fire } from './js/fire.js'

camera.near = 0.1
camera.far = 200.0
camera.position.set(3, 2, 3)

postprocessing.setBloomPass({
  threshold: 0,
  strength: 0.3,
  radius: 0.3
})

ambientLight.intensity = 4

const controls = orbitControls()
controls.autoRotate = true

{
  const intensity = 3.0
  const light = new THREE.PointLight(COLORS.warmLight, intensity)
  light.castShadow = true
  light.position.set(-1, 1.4, 1)
  light.shadow.mapSize.width = SHADOW_MAP.width
  light.shadow.mapSize.height = SHADOW_MAP.height
  light.shadow.radius = 8
  light.shadow.bias = -0.0001
  scene.add(light)
}

const main = async () => {
  const handleProgress = (...args) => {
    console.log(args)
  }

  const [gltf] = await loadModels([
    {
      src: 'assets/gltf/chair.glb',
      shadows: false,
      anisotropy: renderer.capabilities.getMaxAnisotropy()
    }
  ], handleProgress)

  scene.add(gltf)

  gltf.position.copy(gltf.getObjectByName('Chair').position.multiplyScalar(-1))
  gltf.updateMatrix()

  
  const frame = () => {
    controls.update()
  }

  initXR()
  setAnimationLoop({ frame, postprocessing: true })
}

main()
</script>
