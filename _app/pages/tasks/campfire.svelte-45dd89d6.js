import{S as t,i as s,s as e,e as o,c as a,a as n,d as i,f as r,H as c,z as m,au as l,W as u,aN as h,aL as d}from"../../chunks/vendor-610434e6.js";import{G as p}from"../../chunks/gl-2e610081.js";import{a as f}from"../../chunks/assets-41b5ac53.js";import{O as y}from"../../chunks/orbitControls-e875f410.js";import{a as b,b as v}from"../../chunks/util-c54cb71a.js";import{e as w,f as g,a as A,g as N}from"../../chunks/util-three-1ef0c915.js";function x(t){let s;return{c(){s=o("canvas")},l(t){s=a(t,"CANVAS",{}),n(s).forEach(i)},m(e,o){r(e,s,o),t[1](s)},p:c,i:c,o:c,d(e){e&&i(s),t[1](null)}}}function j(t,s,e){var o=this&&this.__awaiter||function(t,s,e,o){return new(e||(e=Promise))((function(a,n){function i(t){try{c(o.next(t))}catch(s){n(s)}}function r(t){try{c(o.throw(t))}catch(s){n(s)}}function c(t){var s;t.done?a(t.value):(s=t.value,s instanceof e?s:new e((function(t){t(s)}))).then(i,r)}c((o=o.apply(t,s||[])).next())}))};class a{constructor(t,s){this.N=100,this.dummy=new h,this.embers=[];for(const e of s){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new Error;const s=new d(e.geometry.clone(),e.material.clone(),this.N),o={mesh:s,p:new Float32Array(3*this.N),r:new Float32Array(3*this.N),s:new Float32Array(this.N),pv:new Float32Array(3*this.N),sv:new Float32Array(3*this.N)};s.position.set(0,.5,0);let a=0;for(;a<this.N;)this.setPropsAtIndex(a,o),a+=1;this.embers.push(o),t.add(s)}}setPropsAtIndex(t,s){const e=3*t,[o,a]=v(1.25);s.p[e+0]=o,s.p[e+1]=b(.1,.75),s.p[e+2]=a,s.s[t]=1,s.sv[t]=b(-.1,-.03),s.pv[e+0]=b(-.01,.05),s.pv[e+1]=b(.01,.05),s.pv[e+2]=b(-.01,.05)}update(t){for(const s of this.embers){const{mesh:t,p:e,s:o,pv:a,sv:n}=s;let i=0;for(;i<this.N;){const r=3*i;o[i]+=n[i],o[i]<=0&&this.setPropsAtIndex(i,s),e[r+0]+=a[r+0],e[r+1]+=a[r+1],e[r+2]+=a[r+2],this.dummy.position.set(e[r],e[r+1],e[r+2]),this.dummy.scale.set(o[i],o[i],o[i]),this.dummy.updateMatrix(),t.setMatrixAt(i,this.dummy.matrix),i+=1}t.instanceMatrix.needsUpdate=!0}}}let n;return m((()=>o(void 0,void 0,void 0,(function*(){const t=new p(n),s=new y(t.camera,document.body);t.camera.position.set(20,4,18),yield Promise.all([t.init(),f.load("FloatingRockScene.glb")]);const{scene:e}=f.get("FloatingRockScene.glb"),o=new a(e.getObjectByName("Fire"),[e.getObjectByName("Ember1"),e.getObjectByName("Ember2"),e.getObjectByName("Ember3")]);t.scene.add(e);const i=w();i.position.y=1.4,t.scene.add(i);const r=g();r.color.setHSL(.6,1,.6),r.groundColor.setHSL(.095,1,.75),t.scene.add(r),r.position.set(0,50,0);const c=A();c.color.setHSL(.1,1,.95),c.position.set(-1,1.75,1).multiplyScalar(30),t.scene.add(c);const m=N(void 0,64);t.scene.add(m);const u={h:0,s:0,l:0};m.material instanceof l&&m.material.color.getHSL(u);let{l:h}=u,d=1e-4,b=1e-4;t.setAnimationLoop((e=>{h-=b,(h<0||h>1)&&(d=-d,b=d,h<=0&&(h=0),h>=1&&(h=1)),t.ambientLight.intensity=h,m.material instanceof l&&m.material.color.setHSL(u.h,u.s,h),o.update(e),s.update()}))})))),[n,function(t){u[t?"unshift":"push"]((()=>{n=t,e(0,n)}))}]}export default class extends t{constructor(t){super(),s(this,t,j,x,e,{})}}
