import{S as t,i as s,s as e,e as a,c as o,a as n,d as i,f as r,H as c,z as m,au as l,W as u,aK as d,aI as h}from"../../chunks/vendor-dc2a1d13.js";import{G as p}from"../../chunks/gl-effbc97e.js";import{a as f}from"../../chunks/assets-6959657a.js";import{O as y}from"../../chunks/orbitControls-a59c44af.js";import{a as b,b as v}from"../../chunks/util-c54cb71a.js";import{e as w,f as g,a as A,g as N}from"../../chunks/util-three-67e281f2.js";function x(t){let s;return{c(){s=a("canvas")},l(t){s=o(t,"CANVAS",{}),n(s).forEach(i)},m(e,a){r(e,s,a),t[1](s)},p:c,i:c,o:c,d(e){e&&i(s),t[1](null)}}}function j(t,s,e){var a=this&&this.__awaiter||function(t,s,e,a){return new(e||(e=Promise))((function(o,n){function i(t){try{c(a.next(t))}catch(s){n(s)}}function r(t){try{c(a.throw(t))}catch(s){n(s)}}function c(t){var s;t.done?o(t.value):(s=t.value,s instanceof e?s:new e((function(t){t(s)}))).then(i,r)}c((a=a.apply(t,s||[])).next())}))};class o{constructor(t,s){this.N=100,this.dummy=new d,this.embers=[];for(const e of s){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new Error;const s=new h(e.geometry.clone(),e.material.clone(),this.N),a={mesh:s,p:new Float32Array(3*this.N),r:new Float32Array(3*this.N),s:new Float32Array(this.N),pv:new Float32Array(3*this.N),sv:new Float32Array(3*this.N)};s.position.set(0,.5,0);let o=0;for(;o<this.N;)this.setPropsAtIndex(o,a),o+=1;this.embers.push(a),t.add(s)}}setPropsAtIndex(t,s){const e=3*t,[a,o]=v(1.25);s.p[e+0]=a,s.p[e+1]=b(.1,.75),s.p[e+2]=o,s.s[t]=1,s.sv[t]=b(-.1,-.03),s.pv[e+0]=b(-.01,.05),s.pv[e+1]=b(.01,.05),s.pv[e+2]=b(-.01,.05)}update(t){for(const s of this.embers){const{mesh:t,p:e,s:a,pv:o,sv:n}=s;let i=0;for(;i<this.N;){const r=3*i;a[i]+=n[i],a[i]<=0&&this.setPropsAtIndex(i,s),e[r+0]+=o[r+0],e[r+1]+=o[r+1],e[r+2]+=o[r+2],this.dummy.position.set(e[r],e[r+1],e[r+2]),this.dummy.scale.set(a[i],a[i],a[i]),this.dummy.updateMatrix(),t.setMatrixAt(i,this.dummy.matrix),i+=1}t.instanceMatrix.needsUpdate=!0}}}let n;return m((()=>a(void 0,void 0,void 0,(function*(){const t=new p(n),s=new y(t.camera,document.body);t.camera.position.set(20,4,18),yield Promise.all([t.init(),f.load("FloatingRockScene.glb")]);const{scene:e}=f.get("FloatingRockScene.glb"),a=new o(e.getObjectByName("Fire"),[e.getObjectByName("Ember1"),e.getObjectByName("Ember2"),e.getObjectByName("Ember3")]);t.scene.add(e);const i=w();i.position.y=1.4,t.scene.add(i);const r=g();r.color.setHSL(.6,1,.6),r.groundColor.setHSL(.095,1,.75),t.scene.add(r),r.position.set(0,50,0);const c=A();c.color.setHSL(.1,1,.95),c.position.set(-1,1.75,1).multiplyScalar(30),t.scene.add(c);const m=N(void 0,64);t.scene.add(m);const u={h:0,s:0,l:0};m.material instanceof l&&m.material.color.getHSL(u);let{l:d}=u,h=1e-4,b=1e-4;t.setAnimationLoop((e=>{d-=b,(d<0||d>1)&&(h=-h,b=h,d<=0&&(d=0),d>=1&&(d=1)),t.ambientLight.intensity=d,m.material instanceof l&&m.material.color.setHSL(u.h,u.s,d),a.update(e),s.update()}))})))),[n,function(t){u[t?"unshift":"push"]((()=>{n=t,e(0,n)}))}]}export default class extends t{constructor(t){super(),s(this,t,j,x,e,{})}}
