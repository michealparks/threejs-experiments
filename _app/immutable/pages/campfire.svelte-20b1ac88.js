import{S as t,i as s,s as e}from"../chunks/index-32ca3be3.js";import{O as a,I as o,j as r,s as n,v as i,l as c,k as l,m,u as p}from"../chunks/camera-86d9f305.js";import{c as d,a as u,b as f}from"../chunks/lights-0029dd0a.js";import{r as y,a as h}from"../chunks/util-343fee83.js";import{c as b}from"../chunks/util-three-232ac56e.js";const g=new a,j=[],v=(t,s)=>{const e=3*t,[a,o]=h(1.25);s.p[e+0]=a,s.p[e+1]=y(.1,.75),s.p[e+2]=o,s.s[t]=1,s.sv[t]=y(-.1,-.03),s.pv[e+0]=y(-.01,.05),s.pv[e+1]=y(.01,.05),s.pv[e+2]=y(-.01,.05)},w=(t,s)=>{for(const e of s){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new TypeError("Material can not be array");const s=new o(e.geometry.clone(),e.material.clone(),100),a={mesh:s,p:new Float32Array(300),r:new Float32Array(300),s:new Float32Array(100),pv:new Float32Array(300),sv:new Float32Array(300)};s.position.set(0,.5,0);let r=0;for(;r<100;)v(r,a),r+=1;j.push(a),t.add(s)}},A=()=>{for(const t of j){const{mesh:s,p:e,s:a,pv:o,sv:r}=t;let n=0;for(;n<100;){const i=3*n;a[n]+=r[n],a[n]<=0&&v(n,t),e[i+0]+=o[i+0],e[i+1]+=o[i+1],e[i+2]+=o[i+2],g.position.set(e[i],e[i+1],e[i+2]),g.scale.set(a[n],a[n],a[n]),g.updateMatrix(),s.setMatrixAt(n,g.matrix),n+=1}s.instanceMatrix.needsUpdate=!0}};function S(t){return(async()=>{r.position.set(20,4,18);const t=d(),s=u();s.color.setHSL(.6,1,.6),s.groundColor.setHSL(.095,1,.75),n.add(s),s.position.set(0,50,0);const e=f();e.color.setHSL(.1,1,.95),e.position.set(-1,1.75,1).multiplyScalar(30),n.add(e);const a=b(void 0,64);n.add(a);const o={h:0,s:0,l:0};a.material instanceof i&&a.material.color.getHSL(o);let{l:y}=o,h=1e-4,g=1e-4;await c("FloatingRockScene.glb");const{scene:j}=l("FloatingRockScene.glb");w(j.getObjectByName("Fire"),[j.getObjectByName("Ember1"),j.getObjectByName("Ember2"),j.getObjectByName("Ember3")]),n.add(j),p((()=>{y-=g,(y<0||y>1)&&(h=-h,g=h,y<=0&&(y=0),y>=1&&(y=1)),t.intensity=y,a.material instanceof i&&a.material.color.setHSL(o.h,o.s,y),A()})),m()})(),[]}class k extends t{constructor(t){super(),s(this,t,S,null,e,{})}}export{k as default};
