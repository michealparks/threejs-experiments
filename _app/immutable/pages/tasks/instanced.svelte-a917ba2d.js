import{S as P,i as C,s as j}from"../../chunks/index-9379afd2.js";import{aw as z,ax as M,ay as T,az as A,aA as $,h as U,G as O,av as Y,a4 as W,aB as X}from"../../chunks/gl-748db77b.js";import{a as v}from"../../chunks/assets-be158862.js";import{O as J}from"../../chunks/orbit-controls-2df194a2.js";class K extends z{constructor(_){super(_),this.type=M}parse(_){const m=function(e,a){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(a||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(a||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(a||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(a||""))}return-1},w=`
`,u=function(e,a,i){a=a||1024;let s=e.pos,n=-1,r=0,l="",t=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=t.indexOf(w))&&r<a&&s<e.byteLength;)l+=t,r+=t.length,s+=128,t+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n?(i!==!1&&(e.pos+=r+n+1),l+t.slice(0,n)):!1},B=function(e){const a=/^#\?(\S+)/,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,n=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,t;if(e.pos>=e.byteLength||!(l=u(e)))return m(1,"no header found");if(!(t=l.match(a)))return m(3,"bad initial token");for(r.valid|=1,r.programtype=t[1],r.string+=l+`
`;l=u(e),l!==!1;){if(r.string+=l+`
`,l.charAt(0)==="#"){r.comments+=l+`
`;continue}if((t=l.match(i))&&(r.gamma=parseFloat(t[1])),(t=l.match(o))&&(r.exposure=parseFloat(t[1])),(t=l.match(s))&&(r.valid|=2,r.format=t[1]),(t=l.match(n))&&(r.valid|=4,r.height=parseInt(t[1],10),r.width=parseInt(t[2],10)),r.valid&2&&r.valid&4)break}return r.valid&2?r.valid&4?r:m(3,"missing image size specifier"):m(3,"missing format specifier")},N=function(e,a,i){const o=a;if(o<8||o>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return m(3,"wrong scanline width");const s=new Uint8Array(4*a*i);if(!s.length)return m(4,"unable to allocate buffer space");let n=0,r=0;const l=4*o,t=new Uint8Array(4),R=new Uint8Array(l);let S=i;for(;S>0&&r<e.byteLength;){if(r+4>e.byteLength)return m(1);if(t[0]=e[r++],t[1]=e[r++],t[2]=e[r++],t[3]=e[r++],t[0]!=2||t[1]!=2||(t[2]<<8|t[3])!=o)return m(3,"bad rgbe scanline format");let G=0,g;for(;G<l&&r<e.byteLength;){g=e[r++];const d=g>128;if(d&&(g-=128),g===0||G+g>l)return m(3,"bad scanline data");if(d){const p=e[r++];for(let D=0;D<g;D++)R[G++]=p}else R.set(e.subarray(r,r+g),G),G+=g,r+=g}const q=o;for(let d=0;d<q;d++){let p=0;s[n]=R[d+p],p+=o,s[n+1]=R[d+p],p+=o,s[n+2]=R[d+p],p+=o,s[n+3]=R[d+p],n+=4}S--}return s},H=function(e,a,i,o){const s=e[a+3],n=Math.pow(2,s-128)/255;i[o+0]=e[a+0]*n,i[o+1]=e[a+1]*n,i[o+2]=e[a+2]*n,i[o+3]=1},V=function(e,a,i,o){const s=e[a+3],n=Math.pow(2,s-128)/255;i[o+0]=A.toHalfFloat(Math.min(e[a+0]*n,65504)),i[o+1]=A.toHalfFloat(Math.min(e[a+1]*n,65504)),i[o+2]=A.toHalfFloat(Math.min(e[a+2]*n,65504)),i[o+3]=A.toHalfFloat(1)},L=new Uint8Array(_);L.pos=0;const E=B(L);if(E!==-1){const e=E.width,a=E.height,i=N(L.subarray(L.pos),e,a);if(i!==-1){let o,s,n;switch(this.type){case T:n=i.length/4;const r=new Float32Array(n*4);for(let t=0;t<n;t++)H(i,t*4,r,t*4);o=r,s=T;break;case M:n=i.length/4;const l=new Uint16Array(n*4);for(let t=0;t<n;t++)V(i,t*4,l,t*4);o=l,s=M;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:a,data:o,header:E.string,gamma:E.gamma,exposure:E.exposure,type:s}}}return null}setDataType(_){return this.type=_,this}load(_,c,y,I){function b(h,m){switch(h.type){case T:case M:h.encoding=$,h.minFilter=U,h.magFilter=U,h.generateMipmaps=!1,h.flipY=!0;break}c&&c(h,m)}return super.load(_,b,y,I)}}function Q(k){const _={overpass:"https://threejs.org/examples/textures/equirectangular/pedestrian_overpass_1k.hdr",quarry:"https://threejs.org/examples/textures/equirectangular/quarry_01_1k.hdr",spot:"https://threejs.org/examples/textures/equirectangular/spot1Lux.hdr",sunset:"https://threejs.org/examples/textures/equirectangular/venice_sunset_1k.hdr"},c=O();c.camera.position.set(1,.8,1),c.ambientLight.intensity=.5;const y=new J(c.camera,document.body);return y.autoRotate=!0,(async()=>{const[b]=await Promise.all([new K().loadAsync(_.sunset),v.load("mug.glb")]),h=300,F=v.get("mug.glb").scene.getObjectByName("Mug"),f=new Y(F.geometry,F.material,h),x=new W;let w=0;for(;w<h;)x.setPosition(Math.random()*8-4,Math.random()*8-4,Math.random()*8-4),f.setMatrixAt(w,x),w+=1;c.scene.add(f);const u=new X(c.renderer);u.compileEquirectangularShader();const B=u.fromEquirectangular(b).texture;c.scene.background=B,c.scene.environment=B,b.dispose(),u.dispose(),c.setAnimationLoop(()=>{y.update()})})(),[]}class ae extends P{constructor(_){super(),C(this,_,Q,null,j,{})}}export{ae as default};
