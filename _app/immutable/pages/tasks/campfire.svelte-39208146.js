import{S as w,i as S,s as v}from"../../chunks/index-9379afd2.js";import{a3 as x,av as A,G as F,al as h}from"../../chunks/gl-748db77b.js";import{a as y}from"../../chunks/assets-be158862.js";import{O as M}from"../../chunks/orbit-controls-2df194a2.js";import{a as m,b as O}from"../../chunks/util-55b26ced.js";import{e as j,f as C,c as H,g as k}from"../../chunks/util-three-07032713.js";const l=100,d=new x,L=[],E=(i,t)=>{for(const e of t){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new TypeError("Material can not be array");const s=new A(e.geometry.clone(),e.material.clone(),l),n={mesh:s,p:new Float32Array(l*3),r:new Float32Array(l*3),s:new Float32Array(l),pv:new Float32Array(l*3),sv:new Float32Array(l*3)};s.position.set(0,.5,0);let r=0;for(;r<l;)b(r,n),r+=1;L.push(n),i.add(s)}},b=(i,t)=>{const e=i*3,[s,n]=O(1.25);t.p[e+0]=s,t.p[e+1]=m(.1,.75),t.p[e+2]=n,t.s[i]=1,t.sv[i]=m(-.1,-.03),t.pv[e+0]=m(-.01,.05),t.pv[e+1]=m(.01,.05),t.pv[e+2]=m(-.01,.05)},N=()=>{for(const i of L){const{mesh:t,p:e,s,pv:n,sv:r}=i;let a=0;for(;a<l;){const o=a*3;s[a]+=r[a],s[a]<=0&&b(a,i),e[o+0]+=n[o+0],e[o+1]+=n[o+1],e[o+2]+=n[o+2],d.position.set(e[o],e[o+1],e[o+2]),d.scale.set(s[a],s[a],s[a]),d.updateMatrix(),t.setMatrixAt(a,d.matrix),a+=1}t.instanceMatrix.needsUpdate=!0}},u={init:E,update:N};function B(i){const t=F();t.camera.position.set(20,4,18);const e=new M(t.camera,t.canvas),s=j();s.position.y=1.4,t.scene.add(s);const n=C();n.color.setHSL(.6,1,.6),n.groundColor.setHSL(.095,1,.75),t.scene.add(n),n.position.set(0,50,0);const r=H();r.color.setHSL(.1,1,.95),r.position.set(-1,1.75,1).multiplyScalar(30),t.scene.add(r);const a=k(void 0,64);t.scene.add(a);const o={h:0,s:0,l:0};a.material instanceof h&&a.material.color.getHSL(o);let{l:c}=o,f=1e-4,g=1e-4;return(async()=>{await y.load("FloatingRockScene.glb");const{scene:p}=y.get("FloatingRockScene.glb");u.init(p.getObjectByName("Fire"),[p.getObjectByName("Ember1"),p.getObjectByName("Ember2"),p.getObjectByName("Ember3")]),t.scene.add(p),t.setAnimationLoop(()=>{c-=g,(c<0||c>1)&&(f=-f,g=f,c<=0&&(c=0),c>=1&&(c=1)),t.ambientLight.intensity=c,a.material instanceof h&&a.material.color.setHSL(o.h,o.s,c),u.update(),e.update()})})(),[]}class _ extends w{constructor(t){super(),S(this,t,B,null,v,{})}}export{_ as default};
