import{S,i as b,s as A,w as v}from"../../chunks/index-9379afd2.js";import{a4 as x,av as F,G as M,al as h}from"../../chunks/gl-4a6563e5.js";import{a as u}from"../../chunks/assets-793f00b4.js";import{O}from"../../chunks/orbitControls-6168c5f3.js";import{a as p,b as j}from"../../chunks/util-d1e0476c.js";import{e as C,f as H,c as k,g as N}from"../../chunks/util-three-9c89ac89.js";const l=100,d=new x,w=[],B=(i,t)=>{for(const e of t){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new Error;const o=new F(e.geometry.clone(),e.material.clone(),l),n={mesh:o,p:new Float32Array(l*3),r:new Float32Array(l*3),s:new Float32Array(l),pv:new Float32Array(l*3),sv:new Float32Array(l*3)};o.position.set(0,.5,0);let r=0;for(;r<l;)L(r,n),r+=1;w.push(n),i.add(o)}},L=(i,t)=>{const e=i*3,[o,n]=j(1.25);t.p[e+0]=o,t.p[e+1]=p(.1,.75),t.p[e+2]=n,t.s[i]=1,t.sv[i]=p(-.1,-.03),t.pv[e+0]=p(-.01,.05),t.pv[e+1]=p(.01,.05),t.pv[e+2]=p(-.01,.05)},E=()=>{for(const i of w){const{mesh:t,p:e,s:o,pv:n,sv:r}=i;let s=0;for(;s<l;){const a=s*3;o[s]+=r[s],o[s]<=0&&L(s,i),e[a+0]+=n[a+0],e[a+1]+=n[a+1],e[a+2]+=n[a+2],d.position.set(e[a],e[a+1],e[a+2]),d.scale.set(o[s],o[s],o[s]),d.updateMatrix(),t.setMatrixAt(s,d.matrix),s+=1}t.instanceMatrix.needsUpdate=!0}},y={init:B,update:E};function I(i){return v(async()=>{const t=M(),e=new O(t.camera,document.body);t.camera.position.set(20,4,18),await u.load("FloatingRockScene.glb");const{scene:o}=u.get("FloatingRockScene.glb");y.init(o.getObjectByName("Fire"),[o.getObjectByName("Ember1"),o.getObjectByName("Ember2"),o.getObjectByName("Ember3")]),t.scene.add(o);const n=C();n.position.y=1.4,t.scene.add(n);const r=H();r.color.setHSL(.6,1,.6),r.groundColor.setHSL(.095,1,.75),t.scene.add(r),r.position.set(0,50,0);const s=k();s.color.setHSL(.1,1,.95),s.position.set(-1,1.75,1).multiplyScalar(30),t.scene.add(s);const a=N(void 0,64);t.scene.add(a);const m={h:0,s:0,l:0};a.material instanceof h&&a.material.color.getHSL(m);let{l:c}=m,f=1e-4,g=1e-4;t.setAnimationLoop(()=>{c-=g,(c<0||c>1)&&(f=-f,g=f,c<=0&&(c=0),c>=1&&(c=1)),t.ambientLight.intensity=c,a.material instanceof h&&a.material.color.setHSL(m.h,m.s,c),y.update(),e.update()})}),[]}class _ extends S{constructor(t){super(),b(this,t,I,null,A,{})}}export{_ as default};
