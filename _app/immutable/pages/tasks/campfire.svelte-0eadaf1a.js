import{S as L,i as S,s as A,w as v}from"../../chunks/index-9379afd2.js";import{a4 as x,av as F,G as M,al as h}from"../../chunks/gl-9f8be024.js";import{a as u}from"../../chunks/assets-a572b544.js";import{O}from"../../chunks/orbit-controls-8a0943e2.js";import{a as p,b as j}from"../../chunks/util-55b26ced.js";import{e as C,f as H,c as k,g as N}from"../../chunks/util-three-bda16444.js";const l=100,d=new x,b=[],B=(i,t)=>{for(const e of t){if(e.matrixAutoUpdate=!0,e.position.set(0,0,0),Array.isArray(e.material))throw new TypeError("Material can not be array");const o=new F(e.geometry.clone(),e.material.clone(),l),n={mesh:o,p:new Float32Array(l*3),r:new Float32Array(l*3),s:new Float32Array(l),pv:new Float32Array(l*3),sv:new Float32Array(l*3)};o.position.set(0,.5,0);let r=0;for(;r<l;)w(r,n),r+=1;b.push(n),i.add(o)}},w=(i,t)=>{const e=i*3,[o,n]=j(1.25);t.p[e+0]=o,t.p[e+1]=p(.1,.75),t.p[e+2]=n,t.s[i]=1,t.sv[i]=p(-.1,-.03),t.pv[e+0]=p(-.01,.05),t.pv[e+1]=p(.01,.05),t.pv[e+2]=p(-.01,.05)},E=()=>{for(const i of b){const{mesh:t,p:e,s:o,pv:n,sv:r}=i;let a=0;for(;a<l;){const s=a*3;o[a]+=r[a],o[a]<=0&&w(a,i),e[s+0]+=n[s+0],e[s+1]+=n[s+1],e[s+2]+=n[s+2],d.position.set(e[s],e[s+1],e[s+2]),d.scale.set(o[a],o[a],o[a]),d.updateMatrix(),t.setMatrixAt(a,d.matrix),a+=1}t.instanceMatrix.needsUpdate=!0}},y={init:B,update:E};function I(i){return v(async()=>{const t=M(),e=new O(t.camera,document.body);t.camera.position.set(20,4,18),await u.load("FloatingRockScene.glb");const{scene:o}=u.get("FloatingRockScene.glb");y.init(o.getObjectByName("Fire"),[o.getObjectByName("Ember1"),o.getObjectByName("Ember2"),o.getObjectByName("Ember3")]),t.scene.add(o);const n=C();n.position.y=1.4,t.scene.add(n);const r=H();r.color.setHSL(.6,1,.6),r.groundColor.setHSL(.095,1,.75),t.scene.add(r),r.position.set(0,50,0);const a=k();a.color.setHSL(.1,1,.95),a.position.set(-1,1.75,1).multiplyScalar(30),t.scene.add(a);const s=N(void 0,64);t.scene.add(s);const m={h:0,s:0,l:0};s.material instanceof h&&s.material.color.getHSL(m);let{l:c}=m,f=1e-4,g=1e-4;t.setAnimationLoop(()=>{c-=g,(c<0||c>1)&&(f=-f,g=f,c<=0&&(c=0),c>=1&&(c=1)),t.ambientLight.intensity=c,s.material instanceof h&&s.material.color.setHSL(m.h,m.s,c),y.update(),e.update()})}),[]}class U extends L{constructor(t){super(),S(this,t,I,null,A,{})}}export{U as default};
