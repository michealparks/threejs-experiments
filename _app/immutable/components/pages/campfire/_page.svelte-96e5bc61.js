import{S as t,i as e,s}from"../../../chunks/index-f58f646f.js";import{O as a,I as o,c as r,b as n,i,s as c,j as l,k as p,l as m,g as d,u as f}from"../../../chunks/index-40248176.js";import{r as u,a as y}from"../../../chunks/util-343fee83.js";import{c as h}from"../../../chunks/util-three-38ee6e66.js";const b=new a,g=[],w=(t,e)=>{const s=3*t,[a,o]=y(1.25);e.p[s+0]=a,e.p[s+1]=u(.1,.75),e.p[s+2]=o,e.s[t]=1,e.sv[t]=u(-.1,-.03),e.pv[s+0]=u(-.01,.05),e.pv[s+1]=u(.01,.05),e.pv[s+2]=u(-.01,.05)},A=(t,e)=>{for(const s of e){if(s.matrixAutoUpdate=!0,s.position.set(0,0,0),Array.isArray(s.material))throw new TypeError("Material can not be array");const e=new o(s.geometry.clone(),s.material.clone(),100),a={mesh:e,p:new Float32Array(300),r:new Float32Array(300),s:new Float32Array(100),pv:new Float32Array(300),sv:new Float32Array(300)};e.position.set(0,.5,0);let r=0;for(;r<100;)w(r,a),r+=1;g.push(a),t.add(e)}},j=()=>{for(const t of g){const{mesh:e,p:s,s:a,pv:o,sv:r}=t;let n=0;for(;n<100;){const i=3*n;a[n]+=r[n],a[n]<=0&&w(n,t),s[i+0]+=o[i+0],s[i+1]+=o[i+1],s[i+2]+=o[i+2],b.position.set(s[i],s[i+1],s[i+2]),b.scale.set(a[n],a[n],a[n]),b.updateMatrix(),e.setMatrixAt(n,b.matrix),n+=1}e.instanceMatrix.needsUpdate=!0}};function v(t){return(async()=>{r.position.set(20,4,18),r.lookAt(0,0,0);const t=n(),e=i();e.color.setHSL(.6,1,.6),e.groundColor.setHSL(.095,1,.75),c.add(e),e.position.set(0,50,0);const s=l();s.color.setHSL(.1,1,.95),s.position.set(-1,1.75,1).multiplyScalar(30),c.add(s);const a=h(void 0,64);c.add(a);const o={h:0,s:0,l:0};a.material instanceof p&&a.material.color.getHSL(o);let{l:u}=o,y=1e-4,b=1e-4;const{scene:g}=await m("FloatingRockScene.glb");A(g.getObjectByName("Fire"),[g.getObjectByName("Ember1"),g.getObjectByName("Ember2"),g.getObjectByName("Ember3")]),c.add(g),f((()=>{u-=b,(u<0||u>1)&&(y=-y,b=y,u<=0&&(u=0),u>=1&&(u=1)),t.intensity=u,a.material instanceof p&&a.material.color.setHSL(o.h,o.s,u),j()})),d()})(),[]}class x extends t{constructor(t){super(),e(this,t,v,null,s,{})}}export{x as default};
